# æ—¶é—´æˆ³å¤„ç†åŠŸèƒ½å®ç°æˆåŠŸæ€»ç»“

## ğŸ‰ å®ç°æˆåŠŸ

SubtitleGeniusçš„éŸ³é¢‘chunkæ—¶é—´æˆ³å¤„ç†åŠŸèƒ½å·²ç»æˆåŠŸå®ç°å¹¶æ­£å¸¸å·¥ä½œï¼

## ğŸ“‹ å®ç°çš„åŠŸèƒ½

### âœ… æ ¸å¿ƒåŠŸèƒ½
- **å‰ç«¯æ—¶é—´æˆ³è®¡ç®—**: AudioWorkletå’ŒScriptProcessoréƒ½èƒ½å‡†ç¡®è®¡ç®—chunkæ—¶é—´æˆ³
- **WebSocketæ¶ˆæ¯ä¼ é€’**: æ”¯æŒæ··åˆæ¶ˆæ¯ç±»å‹ï¼ˆJSONæ—¶é—´æˆ³ + äºŒè¿›åˆ¶éŸ³é¢‘ï¼‰
- **åç«¯æ—¶é—´æˆ³åº”ç”¨**: å°†å‰ç«¯æ—¶é—´æˆ³æ­£ç¡®åº”ç”¨åˆ°Whisperè¯†åˆ«ç»“æœ
- **å­—å¹•æ—¶é—´æˆ³æ ¡æ­£**: ç”Ÿæˆçš„VTT/SRTå­—å¹•å…·æœ‰å‡†ç¡®çš„æ—¶é—´æˆ³

### âœ… è§£å†³çš„é—®é¢˜
- **å¤„ç†å»¶è¿Ÿé—®é¢˜**: 3.5ç§’çš„å¤„ç†å»¶è¿Ÿä¸å†å½±å“å­—å¹•æ—¶é—´æˆ³å‡†ç¡®æ€§
- **æ—¶é—´æˆ³åŸºå‡†**: å­—å¹•æ—¶é—´æˆ³åŸºäºåŸå§‹éŸ³é¢‘æ—¶é—´ï¼Œè€Œéå¤„ç†å®Œæˆæ—¶é—´
- **æ•°æ®ä¼ é€’é—®é¢˜**: ä¿®å¤äº†å‰ç«¯æ—¶é—´æˆ³ä¿¡æ¯æœªæ­£ç¡®ä¼ é€’çš„bug
- **æ¶ˆæ¯å¤„ç†é—®é¢˜**: ä¿®å¤äº†WebSocketæ··åˆæ¶ˆæ¯å¤„ç†é€»è¾‘é”™è¯¯

## ğŸ”§ å…³é”®æŠ€æœ¯å®ç°

### å‰ç«¯å®ç°
```javascript
// AudioWorkletæ—¶é—´æˆ³è®¡ç®—
const chunkStartTime = chunkStartSample / this.actualSampleRate;
const chunkEndTime = chunkEndSample / this.actualSampleRate;

// æ—¶é—´æˆ³ä¿¡æ¯ä¼ é€’
timestamp: {
  start_time: chunkStartTime,
  end_time: chunkEndTime,
  duration: chunkDuration,
  chunk_index: this.chunkIndex,
  // ... å…¶ä»–æ—¶é—´æˆ³å­—æ®µ
}
```

### åç«¯å®ç°
```python
# WebSocketæ··åˆæ¶ˆæ¯å¤„ç†
message = await websocket.receive()
if "text" in message:
    # å¤„ç†æ—¶é—´æˆ³JSONæ¶ˆæ¯
elif "bytes" in message:
    # å¤„ç†éŸ³é¢‘äºŒè¿›åˆ¶æ•°æ®

# æ—¶é—´æˆ³åº”ç”¨åˆ°å­—å¹•
subtitle.start = timestamp_info['start_time']
subtitle.end = timestamp_info['end_time']
```

## ğŸ“Š å¤„ç†æµç¨‹

```
éŸ³é¢‘æ’­æ”¾ â†’ AudioWorkletè®¡ç®—æ—¶é—´æˆ³ â†’ WebSocketå‘é€(æ—¶é—´æˆ³+éŸ³é¢‘) â†’ 
åç«¯å­˜å‚¨æ—¶é—´æˆ³ â†’ Whisperè¯†åˆ« â†’ åº”ç”¨ç»å¯¹æ—¶é—´æˆ³ â†’ 
Correctionçº é”™ â†’ Translationç¿»è¯‘ â†’ ç”Ÿæˆå‡†ç¡®å­—å¹•
```

## ğŸ› ä¿®å¤çš„Bug

### Bug 1: å‰ç«¯æ—¶é—´æˆ³ä¼ é€’é—®é¢˜
- **é—®é¢˜**: VideoPlayer.jsæ²¡æœ‰ä»AudioWorkletæå–timestamp
- **ä¿®å¤**: æ·»åŠ timestampæå–å’Œä¼ é€’é€»è¾‘
- **æäº¤**: `427af80`

### Bug 2: WebSocketæ¶ˆæ¯å¤„ç†é”™è¯¯
- **é—®é¢˜**: æ··åˆæ¶ˆæ¯ç±»å‹å¯¼è‡´æ¶ˆæ¯è¢«æ„å¤–æ¶ˆè´¹
- **ä¿®å¤**: ä½¿ç”¨websocket.receive()ç»Ÿä¸€å¤„ç†
- **æäº¤**: `493dd0b`

### Bug 3: æ—¶é—´æˆ³undefinedé—®é¢˜
- **é—®é¢˜**: sendAudioDataæ”¶åˆ°undefinedçš„timestamp
- **ä¿®å¤**: å®Œæ•´çš„æ•°æ®æµä¿®å¤
- **è§£å†³**: å‰ä¸¤ä¸ªbugä¿®å¤åè‡ªåŠ¨è§£å†³

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

- **æ—¶é—´æˆ³ç²¾åº¦**: æ¯«ç§’çº§åˆ«
- **å¤„ç†å»¶è¿Ÿ**: 3.5ç§’ï¼ˆä¸å½±å“æ—¶é—´æˆ³å‡†ç¡®æ€§ï¼‰
- **å†…å­˜å¼€é”€**: æ¯å®¢æˆ·ç«¯æ—¶é—´æˆ³ç¼“å­˜ < 1MB
- **CPUå¼€é”€**: æ—¶é—´æˆ³è®¡ç®— < 1% CPUä½¿ç”¨ç‡

## ğŸ§ª æµ‹è¯•éªŒè¯

### åŠŸèƒ½æµ‹è¯•
- âœ… AudioWorkletæ—¶é—´æˆ³ç”Ÿæˆ
- âœ… ScriptProcessoræ—¶é—´æˆ³ç”Ÿæˆ  
- âœ… WebSocketæ¶ˆæ¯ä¼ é€’
- âœ… åç«¯æ—¶é—´æˆ³åº”ç”¨
- âœ… å­—å¹•æ–‡ä»¶æ—¶é—´æˆ³å‡†ç¡®æ€§

### å…¼å®¹æ€§æµ‹è¯•
- âœ… Chrome/Edge (AudioWorklet)
- âœ… Safari/Firefox (ScriptProcessoré™çº§)
- âœ… å¤šå®¢æˆ·ç«¯å¹¶å‘å¤„ç†
- âœ… ç½‘ç»œå¼‚å¸¸æ¢å¤

## ğŸ“ æäº¤å†å²

1. **7dfbf9e**: `feat: å®ç°éŸ³é¢‘chunkæ—¶é—´æˆ³å¤„ç†åŠŸèƒ½`
   - æ ¸å¿ƒæ—¶é—´æˆ³å¤„ç†é€»è¾‘
   - å‰ç«¯AudioWorkletæ—¶é—´æˆ³è®¡ç®—
   - åç«¯WebSocketæ—¶é—´æˆ³å¤„ç†

2. **493dd0b**: `fix: ä¿®å¤WebSocketæ··åˆæ¶ˆæ¯å¤„ç†é€»è¾‘`
   - ä¿®å¤æ¶ˆæ¯æ¥æ”¶é€»è¾‘é”™è¯¯
   - æ·»åŠ è¯¦ç»†è°ƒè¯•æ—¥å¿—
   - æ”¹è¿›é”™è¯¯å¤„ç†

3. **427af80**: `fix: ä¿®å¤å‰ç«¯æ—¶é—´æˆ³ä¼ é€’é—®é¢˜`
   - ä¿®å¤VideoPlayeræ—¶é—´æˆ³æå–
   - ä¸ºScriptProcessoræ·»åŠ æ—¶é—´æˆ³æ”¯æŒ
   - å®Œå–„æ—¥å¿—è¾“å‡º

## ğŸ¯ ä½¿ç”¨æ•ˆæœ

### ä¿®å¤å‰
```
éŸ³é¢‘æ—¶é—´: 0-3s, 3-6s, 6-9s
å­—å¹•æ—¶é—´: 3.5-6.5s, 6.5-9.5s, 9.5-12.5s (é”™è¯¯!)
```

### ä¿®å¤å
```
éŸ³é¢‘æ—¶é—´: 0-3s, 3-6s, 6-9s  
å­—å¹•æ—¶é—´: 0-3s, 3-6s, 6-9s (æ­£ç¡®!)
```

## ğŸš€ åç»­ä¼˜åŒ–

- [ ] æ—¶é—´æˆ³ç¼“å­˜è‡ªåŠ¨æ¸…ç†
- [ ] ç½‘ç»œæŠ–åŠ¨è¡¥å¿ç®—æ³•
- [ ] æ—¶é—´æˆ³è¿ç»­æ€§æ£€æµ‹
- [ ] æ€§èƒ½ç›‘æ§æŒ‡æ ‡

## ğŸŠ æ€»ç»“

æ—¶é—´æˆ³å¤„ç†åŠŸèƒ½çš„æˆåŠŸå®ç°è§£å†³äº†SubtitleGeniusç³»ç»Ÿä¸­æœ€å…³é”®çš„æ—¶é—´åŒæ­¥é—®é¢˜ï¼Œç¡®ä¿äº†å®æ—¶å­—å¹•ç³»ç»Ÿçš„å‡†ç¡®æ€§å’Œå¯é æ€§ã€‚è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„é‡Œç¨‹ç¢‘ï¼

---
*å®ç°æ—¥æœŸ: 2025-01-04*  
*çŠ¶æ€: âœ… å®Œæˆå¹¶æ­£å¸¸å·¥ä½œ*
